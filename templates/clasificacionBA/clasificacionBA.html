{% load static %}

<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
  {% load static %}
  <script type="text/javascript" src="{% static 'clasificacionBA/clasificacionBA.js' %}"></script>
  <title> Clasificacion BA </title>

  <link rel="stylesheet" href="{% static 'css/estilo.css' %}">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  
  <link href="https://fonts.googleapis.com/css2?family=Lobster+Two:ital@1&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Lobster+Two:ital@1&display=swap" rel="stylesheet">


  <style type="text/css">
    #global {
      max-width: 100%;
      height: auto;
      overflow-x: scroll;
    }
    #global14 {
      max-width: 20%;
      height: auto;
      overflow-x: scroll;
    }
    #global2 {
      max-width: 100%;
      height: 380px;
      overflow-y: scroll;
    }
    #global3 {
      max-width: 100%;
      height: 300px;
      overflow-y: scroll;
    }
    #global11 {
      max-width: 100%;
      height: 500px;
      overflow-y: scroll;
    }
    #global4 {
      max-width: 30%;
      height: 300px;
      overflow-y: scroll;
    }
    #global5 {
      max-width: 80%;
      height: 300px;
      overflow-y: scroll;
    }
    #global6 {
      max-width: 60%;
      height: auto;
      overflow-y: scroll;
    }
    #global7 {
      max-width: 70%;
      height: 450px;
      overflow-x: scroll;
    }
    #global8 {
      max-width: 30%;
      height: auto;
      overflow-y: scroll;
    }
    #global9 {
      max-width: 50%;
      height: 300px;
      overflow-y: scroll;
    }
    #mensajes {
      height: auto;
    }
    .cardCentrar{
      display: flex;
      justify-content: center !important;
    }

    h4.titulo{
      margin-top: 10px;
      margin-bottom: 20px;
      color: palevioletred;
      font-family: 'Bebas Neue';
      font-size: 50px;
      text-transform: uppercase;
      font-weight: 800;
      text-shadow: 3px 3px pink;
    }

    .card-header{
      color: #074141;
      font-family: 'Bebas Neue';
      font-size: 25px;
      font-weight: 800;
    }
    .selectAltura {
      text-align: center;
      float:left;
      margin-left: 30%;
      height:60px;
      width:250px;
      font-size: medium;
    }
    .selectAltura2 {
      text-align: center;
      height:80px;
      width:200px;
      font-size: medium;
    }
    .selectAltura3 {
      text-align: center;
      height: 60px;
      font-size: medium;
    }
    .selectAltura4 {
      text-align: center;
      height: 40px;
      font-size: medium;
    }
    .selectAltura5 {
      text-align: center;
      width:200px;
      font-size: medium;
    }
    .boton1 {
      height:40px;
      width:80px;
    }
    .boton2 {
      height:40px;
      width:80px;
    }
  </style>
</head>

<body style="background-color: #FBFBF5;">
  <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #1f2c38;">
    <div class="container-fluid">
      <div class="row w-55 text-left">
        <div class="col">
          <a class="navbar-brand" href="/">
            <img src="{% static '/images/Logo.png' %}" width="120" height="80">
          </a>
        </div>
      </div>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
  
      <div class="collapse navbar-collapse" id="navbarText">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="{% url 'eda' %}">EDA</a>
          </li>
          &nbsp;&nbsp;
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="{% url 'acpd' %}">PCA / ACD</a>
          </li>
          &nbsp;&nbsp;
          <li class="nav-item dropdown">
            <a class="nav-link active dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Árboles de Decisión
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="{% url 'pronosticoAD' %}" >Pronóstico</a></li>
              <li><a class="dropdown-item" href="{% url 'clasificacionAD' %}">Clasificación</a></li>
            </ul>
          </li>
          &nbsp;&nbsp;
          <li class="nav-item dropdown">
            <a class="nav-link active dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Bosques Aleatorios
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="{% url 'pronosticoBA' %}">Pronóstico</a></li>
              <li><a class="dropdown-item" href="{% url 'clasificacionBA' %}">Clasificación</a></li>
            </ul>
          </li>
          &nbsp;&nbsp;
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="{% url 'kmeans' %}">Segmentación y Clasificación</a>
          </li>
          &nbsp;&nbsp;
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="#">SVM</a>
          </li>
          &nbsp;&nbsp;
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="{% url 'historico' %}">Historial</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <br><br>
  <div class="container-sm cardCentrar">
    <div class="card text-left border-danger" style="width: 100rem;">
      <div class="card-body">
        <h4 class="card-title text-center titulo">Bosques Aleatorios (Clasificación)</h4> 
        <p class="card-text"> Los bosques aleatorios son una variación moderna que agrupan varios árboles de
          decisión (cuantos más árboles se tiene, más robusto es el bosque) para producir un modelo 
          generalizado con el objetivo de reducir la tendencia al sobreajuste. Permiten resolver problemas de 
          <b>pronóstico</b> y <b>clasificación</b> además de que admiten valores numéricos y nominales. 
          <br>
          El procedimiento para obtener es bosque aleatorio es:
          <ul>
            <li type="disc">Selección de muestras aleatorias a partir del conjunto de datos.</li>
            <li type="disc">Se construye un árbol de decisión para cada muestra y se obtiene un resultado.</li>
            <li type="disc">Se realiza una votación (clasificación) opromedio (regresión) con base en los resultados.</li>
            <li type="disc">Se selecciona el resultado con más votos (clasificación) o promedio final (regresión).</li>
          </ul>
      </div>
    </div>
  </div> 
  <br><br>

  <article>
    {% csrf_token %}
    <!-- <h2 class="subtitle container-fluid">Información general del DataFrame:</h2> -->
    <div class="container-sm cardCentrar">
      <div class="card border-danger" style="width: 1300px">
        <div class="card-header text-center">
          Gráficas para tener idea general del comportamiento de los datos del DataFrame
        </div>
        <div class="card-body">
          <section>
            <form id="graficas">
              Seleccione las variables a graficar:
              <center>
              <select class="form-select form-select-sm selectAltura2" aria-label=".form-select-sm example" name="columnas" id="columnas" multiple>
                {% for i in data.columnas %}
                <option>{{ i }}</option>
                {% endfor %}
              </select>
              </center>
              <br>
              <center><input class="btn btn-success boton1" type="submit"></center>
            </form>
            <center><button class="btn btn-danger boton1" onclick="limpiarImagenes('#img-graficas')">Limpiar</button></center>            
          </section>
          <center><section id="img-graficas"></section></center>
        </div>
      </div>
    </div> 
  <br><br>
    
  <article>
    {% csrf_token %}
    <!-- <h2 class="subtitle container-fluid">Información general del DataFrame:</h2> -->
    <div class="container-sm cardCentrar">
      <div class="card border-danger" style="width: 1300px">
        <div class="card-header text-center">
          Selección de características
        </div>
        <div class="card-body">
          <div class="card-body">
            <div class="card">
              <div class="card-header text-center">
                1) Mapa de calor
              </div>
              <div class="card-body cardCentrar">
                <img class="img-fluid" id="heatMap" src="data:image/svg+xml;base64,{{ data.MapaCalor }}" width="900">
              </div>
              Cabe recordar que:
              <ul>
                <li type="disc">Correlación de 0 a 0.33 - indica relación débil</li>
                <li type="disc">Correlación de 0.34 a 0.66 - indica relación moderada</li>
                <li type="disc">Correlación de 0.67 a 1 - indica relación fuerte</li>
              </ul>
            </div>
            <br><br>
            <div class="card">
              <div class="card-header text-center">
                2) Matriz de correlaciones
              </div>
              <div class="card-body">
                <div id="global2">
                  <div id="mensajes">
                    {{ data.MatrizCorr | safe}}
                  </div>
                </div>
              </div>
            </div>
            <br><br>
            <div class="card">
              <div class="card-header text-center">
                3) Selección de variables
              </div>
              <div class="card-body">
                <center>
                <select name="colCount" id="quitar" multiple class="form-select form-select-sm selectAltura5" aria-label=".form-select-sm example">
                  {% for i in data.columTotal %}
                  <option>{{ i }}</option>
                  {% endfor %}
                </select>
                <br>
                <button class="btn btn-danger" onclick="limpiarDataFrame()">Eliminar variables</button>
                </center>
                <br>
                <div id="global2">
                  <div id="mensajes">
                    <section id="tabla">
                    <center>
                      {{ data.dataFram | safe}}
                    </section>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div> 
  <br><br>

  <article>
    {% csrf_token %}
    <!-- <h2 class="subtitle container-fluid">Información general del DataFrame:</h2> -->
    <div class="container-sm cardCentrar">
      <div class="card border-danger" style="width: 1300px">
        <div class="card-header text-center">
          Definición de las variables predictoras (X) y variable clase (Y).
        </div>
        <div class="card-body">
          <center>
          <div class="input-group mb-4" style="width: 400px">
            <span class="input-group-text selectAltura3" id="inputGroup-sizing-default">Variables predictoras (X):</span>
            <select class="form-select form-select-sm selectAltura3" aria-label=".form-select-sm example" name="columnas" id="xbosque" multiple>
              {% for i in data.columnasT %}
              <option>{{ i }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="input-group mb-4" style="width: 400px">
            <span class="input-group-text selectAltura4" id="inputGroup-sizing-default">Variable a pronosticar (Y):</span>
            <select class="form-select form-select-sm selectAltura4" aria-label=".form-select-sm example" name="columnas" id="ybosque">
              {% for i in data.columnasT %}
                <option>{{ i }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="input-group mb-2">
            <span class="input-group-text selectAltura4" id="inputGroup-sizing-default">Tamaño de prueba:</span>
            <input type="number" class="form-control selectAltura5" min="0.01" max="0.99" step="0.01" placeholder="test_size" id="testBosque">
          </div>
          <div class="input-group mb-2">
            <span class="input-group-text selectAltura4" id="inputGroup-sizing-default">Número de árboles que va a tener el bosque aleatorio:</span>
              <input type="number" class="form-control selectAltura5" min="1" max="1001" step="1" placeholder="n_estimators" id="numArboles">
          </div>
          <div class="input-group mb-2">
            <span class="input-group-text selectAltura4" id="inputGroup-sizing-default">Máxima profundidad a la cual puede llegar el árbol:</span>
              <input type="number" class="form-control selectAltura5" min="1" max="50" step="1" placeholder="max_depth" id="depthBosque">
          </div>
          <div class="input-group mb-2">
            <span class="input-group-text selectAltura4" id="inputGroup-sizing-default">Cantidad mínima que debe de tener nodo hoja:</span>
            <input type="number" class="form-control selectAltura5" min="1" max="50" step="1" placeholder="min_samples_leaf" id="leafsBosque">
          </div>
          <div class="input-group mb-2">
            <span class="input-group-text selectAltura4" id="inputGroup-sizing-default">Cantidad mínima para que un nodo de decisión se divida:</span>
            <input type="number" class="form-control selectAltura5" min="2" max="50" step="1" placeholder="min_samples_split" id="nodesBosque">
          </div>  
        </div>
        <center>
        <button class="btn btn-success" onclick="realizarClasificacionBosque()">Enviar</button>
        <button class="btn btn-danger" onclick="limpiarSecciones()">Limpiar</button>
        <br><br>
        </center>
        </div>
      </div>
    </div> 
  <br><br>
  </article>

  <article>
    {% csrf_token %}
    <!-- <h2 class="subtitle container-fluid">Información general del DataFrame:</h2> -->
    <div class="container-sm cardCentrar">
      <div class="card border-danger" style="width: 1300px">
        <div class="card-header text-center">
          DataFrame de variables predictoras (X) y variable clase (Y).
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-sm-6">
              <div class="card">
                <div class="card-header text-center">
                  1) DataFrame de variables predictoras (X).
                </div>
                <div class="card-body">
                  <div id="global3">
                    <div id="mensajes">
                      <section id="X"></section>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="card">
                <div class="card-header text-center">
                  2) DataFrame de variable clase (Y).
                </div>
                <center>
                  <div class="card-body">
                    <div id="global9">
                      <div id="mensajes">
                        <section id="Y"></section>
                      </div>
                    </div>
                  </div>
                </center>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div> 
  <br><br>

  <article>
    {% csrf_token %}
    <!-- <h2 class="subtitle container-fluid">Información general del DataFrame:</h2> -->
    <div class="container-sm cardCentrar">
      <div class="card border-danger" style="width: 1300px">
        <div class="card-header text-center">
          Creación de los modelos
        </div>
        <div class="card-body">
          <section id="XYtrain"></section>
          <section id="XYvalid"> </section>
        </div>
      </div>
    </div>
  </div>
  </article> 
  <br><br>

  <article>
    {% csrf_token %}
    <!-- <h2 class="subtitle container-fluid">Información general del DataFrame:</h2> -->
    <div class="container-sm cardCentrar">
      <div class="card border-danger" style="width: 1300px">
        <div class="card-header text-center">
          Se entrena el modelo
        </div>
        <div class="card-body">
          Internamente se entrena el modelo de acuerdo con los valores max_depth, min_samples_split y min_samples_leaf indicados al inicio:
          <br><br>
          <div class="row">
            <div class="col-sm-6">
              <div class="card">
                <div class="card-header text-center">
                  1) Se genera la clasificación
                </div>
                <center>
                  <div class="card-body">
                    <div id="global7">
                      <div id="mensajes">
                        <section id="clasFinal"></section>
                      </div>
                    </div>
                  </div>
                </center> 
              </div>
            </div>
            <div class="col-sm-6">
              <div class="card">
                <div class="card-header text-center">
                  2) Comparar los valores de prueba y estimados
                </div>
                <center>
                  <div class="card-body">
                    <div id="global7">
                      <div id="mensajes">
                        <section id="Ycomp"></section>
                      </div>
                    </div>
                  </div>
                </center>
              </div>
            </div>
          </div>
          <br><br>
          <center><section id="score"></section></center>
        </div>
      </div>
    </div> 
  <br><br>

  <article>
    {% csrf_token %}
    <!-- <h2 class="subtitle container-fluid">Información general del DataFrame:</h2> -->
    <div class="container-sm cardCentrar">
      <div class="card border-danger" style="width: 1300px">
        <div class="card-header text-center">
          Matriz de confusión
        </div>
        <div class="card-body">
          Se muestra la matriz de confusión para observar las clasificaciones correctas e incorrectas.
          <br><br>
          <center>
            <div id="global8">
              <div id="mensajes6">
                <section id="crossTa"></section>
              </div>
            </div>
          </center>
        </div>
      </div>
    </div>
  </div>
  </article> 
  <br><br>

  <article>
    {% csrf_token %}
    <!-- <h2 class="subtitle container-fluid">Información general del DataFrame:</h2> -->
    <div class="container-sm cardCentrar">
      <div class="card border-danger" style="width: 1300px">
        <div class="card-header text-center">
          Reporte de la clasificación
        </div>
        <div class="card-body">
          <section id="predInfo"></section>
          <center>
            <div id="global6">
              <div id="mensajes6">
                <section id="report"></section>
              </div>
            </div>
          </center>
        </div>
      </div>
    </div>
  </div>
  </article> 
  <br><br>


  <article>
    {% csrf_token %}
    <!-- <h2 class="subtitle container-fluid">Información general del DataFrame:</h2> -->
    <div class="container-sm cardCentrar">
      <div class="card border-danger" style="width: 1300px">
        <div class="card-header text-center">
          Importancia de las variables
        </div>
        <div class="card-body">
          Se muestra un DataFrame con la importancia de las variables ordenándolas de mayor a menor importancia:
          <br><br>
          <center>
            <div id="global6">
              <div id="mensajes6">
                <section id="dfImport"></section>
              </div>
            </div>
          </center>
        </div>
      </div>
    </div>
  </div>
  </article> 
  <br><br>

  <article>
    {% csrf_token %}
    <!-- <h2 class="subtitle container-fluid">Información general del DataFrame:</h2> -->
    <div class="container-sm cardCentrar">
      <div class="card border-danger" style="width: 1300px">
        <div class="card-header text-center">
          Conformación del árbol
        </div>
        <div class="card-body">
          <center>
            <section id="tree"></section>
          </center>
        </div>
      </div>
    </div>
  </div>
  </article> 
  <br><br>

  <article>
    {% csrf_token %}
    <!-- <h2 class="subtitle container-fluid">Información general del DataFrame:</h2> -->
    <div class="container-sm cardCentrar">
      <div class="card border-danger" style="width: 1300px">
        <div class="card-header text-center">
          Reglas del modelo
        </div>
        <div class="card-body">
          <div id="global11">
            <div id="mensajes">
              <pre id="reglas"></pre>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  </article> 
  <br><br>

  <article>
    {% csrf_token %}
    <!-- <h2 class="subtitle container-fluid">Información general del DataFrame:</h2> -->
    <div class="container-sm cardCentrar">
      <div class="card border-danger" style="width: 1300px">
        <div class="card-header text-center">
          Validación (rendimiento)
        </div>
        <div class="card-body">
          <center>
            <section id="curvaRoc"></section>
          </center>
        </div>
      </div>
    </div>
  </div>
  </article> 
  <br><br>

  <article>
    {% csrf_token %}
    <!-- <h2 class="subtitle container-fluid">Información general del DataFrame:</h2> -->
    <div class="container-sm cardCentrar">
      <div class="card border-danger" style="width: 1300px">
        <div class="card-header text-center">
          Nuevas clasificaciones
        </div>
        <div class="card-body">
          Ingrese el valor de las siguientes variables:
          <center>
          <section id="nuevC">
            <div class="input-group mb-2" style="width: 300px">
              <span class="input-group-text selectAltura4" id="inputGroup-sizing-default">Pregnancies: </span>
              <input type="number" class="form-control selectAltura5" id="pregnancies">
            </div>
            <div class="input-group mb-2" style="width: 300px">
              <span class="input-group-text selectAltura4" id="inputGroup-sizing-default">Glucose:</span>
                <input type="number" class="form-control selectAltura5" id="glucose">
            </div>
            <div class="input-group mb-2" style="width: 300px">
              <span class="input-group-text selectAltura4" id="inputGroup-sizing-default">BloodPressure:</span>
              <input type="number" class="form-control selectAltura5" id="bloodPressure">
            </div>
            <div class="input-group mb-2" style="width: 300px">
              <span class="input-group-text selectAltura4" id="inputGroup-sizing-default">SkinThickness: </span>
              <input type="number" class="form-control selectAltura5" id="skinThickness">
            </div>
            <div class="input-group mb-2" style="width: 300px">
              <span class="input-group-text selectAltura4" id="inputGroup-sizing-default">Insulin: </span>
              <input type="number" class="form-control selectAltura5" id="insulin">
            </div>
            <div class="input-group mb-2" style="width: 300px">
              <span class="input-group-text selectAltura4" id="inputGroup-sizing-default">BMI: </span>
              <input type="number" class="form-control selectAltura5" id="bmi">
            </div>
            <div class="input-group mb-2" style="width: 300px">
              <span class="input-group-text selectAltura4" id="inputGroup-sizing-default">DiabetesPedigreeFunction: </span>
              <input type="number" class="form-control selectAltura5" id="diabetesPedigreeFunction">
            </div>
            <div class="input-group mb-2" style="width: 300px">
              <span class="input-group-text selectAltura4" id="inputGroup-sizing-default">Age: </span>
              <input type="number" class="form-control selectAltura5" id="age">
            </div>
            <br>
            <button class="btn btn-success boton1" onclick="realizarNuevaClas()">Enviar</button>  
            <button class="btn btn-danger boton1" onclick="limpiarImagenes('#newC')">Eliminar</button> 
          </section>
          </center>
          <br>    
          <center>
            <div id="global14">
              <div id="mensajes6">
                <section id="newC"></section>
              </div>
            </div>     
          </center>
        </div>
      </div>
    </div>
  </div>
  </article> 
  <br><br>

  <br><br><br><br><br>
  <div class="container-sm cardCentrar">
    <a href="/">
      <button class="btn btn-success regular-button botones"> Regresar para ingresar otro archivo </button>
    </a>
  </div> 
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>

</body>

<footer>
  Intelligent Miner  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Fernández Soto Erika Fabiola  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Minería de Datos
</footer>
</html>